#!/bin/bash

BITS=$(python -c "import platform; print(platform.architecture()[0][:2], end='')")

if [[ $BITS == "32" ]]
then
    export ARCH=Win32
    PREFIX="/c/Program Files (x86)"
else
    PREFIX="/c/Program Files"
fi

test -d "$PREFIX/athr" && rm -rf "$PREFIX/athr" || true
test -d "$PREFIX/bgen" && rm -rf "$PREFIX/bgen" || true
test -d "$PREFIX/zlib" && rm -rf "$PREFIX/zlib" || true
test -d "$PREFIX/zstd" && rm -rf "$PREFIX/zstd" || true

bash -c "$(curl -fsSL https://raw.githubusercontent.com/horta/zstd.install/main/install)"
powershell -Command "(New-Object Net.WebClient).DownloadFile('https://raw.githubusercontent.com/horta/zlib.install/master/install.bat', 'install.bat')"; ./install.bat
bash -c "$(curl -fsSL https://git.io/JerYI)" -s horta/almosthere
bash -c "$(curl -fsSL https://git.io/JerYI)" -s limix/bgen

cp "$PREFIX/athr/bin/athr.dll" cbgen/
cp "$PREFIX/bgen/bin/bgen.dll" cbgen/
cp "$PREFIX/zlib/bin/zlib.dll" cbgen/
cp "$PREFIX/zstd/bin/zstd.dll" cbgen/
